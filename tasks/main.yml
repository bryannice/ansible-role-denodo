---
# tasks file for install Denodo
- include_tasks: variables.yml

- include_tasks: setup-OS-Family-RedHat.yml
  when: ansible_os_family == 'RedHat'

- name: Upload and decompress install file
  unarchive:
    src: "{{ denodo_install_payload }}/denodo-install-solutionmanager-8.0-ga-linux64.zip"
    dest: /

- name: Upload install config xml
  template:
    src: solution_manager_installer_configuration_8_0.jinja
    dest: /denodo-install-solutionmanager-8.0/solution_manager_installer_configuration_8_0.xml

- name: Change installer shell to executable
  file:
    path: /denodo-install-solutionmanager-8.0/installer_cli.sh
    mode: +x

- name: Install Denodo Solution Manager
  shell:
    cmd: /denodo-install-solutionmanager-8.0/installer_cli.sh install --autoinstaller solution_manager_installer_configuration_8_0.xml
  async: 1000
  poll: 0
  register: denodo_solution_manager_installer

- name: Check when Denodo Solution Manager Completes
  async_status:
    jid: "{{ denodo_solution_manager_installer.ansible_job_id }}"
  delay: 10
  ignore_errors: True
  register: job_result
  retries: 180
  until: job_result.finished

- name: Remove installer directory
  file:
    path: /denodo-install-solutionmanager-8.0
    state: absent
